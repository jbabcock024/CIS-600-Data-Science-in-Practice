---
title: "Learning Portfolio Assignment 2"
author: 'Josh Babcock #118'
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(mice)

bridges <- read.csv("bridges.data.version1.csv", header=FALSE)

```


I. Finding Suitable Data

link: https://cyber.army.mil/Research/Research-Labs/Datasets/#dataset1

aim: Use R for analyses on the dataset to then be able to use Python for AI/ML approach based on findings from the analyses.


II. Data Pre-processing

  a. Address all the missing values.

```{r}
# address the missing header
colnames(bridges) <- c("Bridge_ID", "River", "Bridge_Number", "Year_Built", 
                  "Purpose", "Length_ft", "Lanes", "Grade", "Span_Type",
                  "Material", "Relative_Length", "Support_Type", "Design_Type")

# see which columns have missing values
bridges[bridges == "?"] <- NA
colSums(is.na(bridges))

# convert data types for mice
class(bridges$Length_ft) = "numeric"
class(bridges$Year_Built) = "numeric"
class(bridges$Bridge_Number) = "numeric"
class(bridges$Lanes) = "numeric"
bridges$Grade <- as.factor(bridges$Grade)
bridges$Span_Type <- as.factor(bridges$Span_Type)
bridges$Material <- as.factor(bridges$Material)
bridges$Relative_Length <- as.factor(bridges$Relative_Length)
bridges$Support_Type <- as.factor(bridges$Support_Type)
bridges$Design_Type <- as.factor(bridges$Design_Type)
sapply(bridges[c("Grade", "Span_Type", "Material", "Relative_Length", "Support_Type", "Design_Type")], class)

# get the average bridge lengths to use as the river widths
river_widths <- bridges %>%
  group_by(River) %>%
  summarize(Width = round(mean(Length_ft, na.rm=TRUE)))

bridges$River_Width <- NA
bridges$River_Width[bridges$River == "A"] <- river_widths$Width[river_widths$River == "A"]  # Allegheny
bridges$River_Width[bridges$River == "M"] <- river_widths$Width[river_widths$River == "M"]  # Monongahela
bridges$River_Width[bridges$River == "O"] <- river_widths$Width[river_widths$River == "O"]  # Ohio
bridges$River_Width[bridges$River == "Y"] <- river_widths$Width[river_widths$River == "Y"]  # Y- ?

# use mice, good for imputations based on multiple variables
imp_vars <- bridges[, c("River", "River_Width", "Bridge_Number", "Year_Built",
                  "Purpose", "Length_ft", "Lanes", "Grade", "Span_Type",
                  "Material", "Relative_Length", "Support_Type", "Design_Type")]
imp <- mice(imp_vars, m=5, maxit=50, method='pmm', seed=500)
plot(imp)
bridges_complete <- complete(imp, 3)

bridges$Length_ft <- bridges_complete$Length_ft
bridges$Lanes <- bridges_complete$Lanes
bridges$Grade <- bridges_complete$Grade
bridges$Span_Type <- bridges_complete$Span_Type
bridges$Material <- bridges_complete$Material
bridges$Relative_Length <- bridges_complete$Relative_Length
bridges$Support_Type <- bridges_complete$Support_Type
bridges$Design_Type <- bridges_complete$Design_Type
bridges$Bridge_Number <- round(bridges_complete$Bridge_Number)

colSums(is.na(bridges))

```

  b. Look for outliers and smooth noisy data.

```{r}
bridges |> ggplot(aes(x=Length_ft)) + geom_boxplot(fill="#1f77b4", color="black")
bridges |> ggplot(aes(x=Year_Built)) + geom_boxplot(fill="#2ca02c", color="black")
bridges |> ggplot(aes(x=Lanes)) + geom_boxplot(fill="#e377c2", color="black")

# there appear to be 3 outliers in the bridge lengths
identify_outliers <- function(x) {
  Q1 <- quantile(x, 0.25)
  Q3 <- quantile(x, 0.75)
  IQR <- Q3 - Q1
  lower_bound <- Q1 - 1.5 * IQR
  upper_bound <- Q3 + 1.5 * IQR
  outliers <- x < lower_bound | x > upper_bound
  return(outliers)
}

length_outliers <- identify_outliers(bridges$Length_ft)
bridges[length_outliers, ]
# these outliers are actually generated by mice

bridges$Length_ft[length_outliers] <- round(bridges$Length_ft[length_outliers] * 0.75)
length_outliers <- identify_outliers(bridges$Length_ft)
bridges[length_outliers, ]
```

  c. Prepare the dataset to establish a relation among:
    i. Length of the bridge and its purpose.
    ii. Number of lanes and its materials.
    iii. Span of the bridge and number of lanes.

```{r}
# i.
purpose_vs_length <- bridges %>%
  group_by(Purpose) %>%
  summarize(Length = round(mean(Length_ft)))
purpose_vs_length

# ii.
material_vs_length <- bridges %>%
  group_by(Material) %>%
  summarize(Lanes = round(mean(Lanes)))
material_vs_length

# iii.
span_vs_length <- bridges %>%
  group_by(Relative_Length) %>%
  summarize(Lanes = round(mean(Lanes)))
span_vs_length
```